# HTTP报文

通过上面的几个章节的介绍其实对HTTP协议已经基本了解了HTTP的工作模式，由于TCP/TP协议负责底层的传输工作，HTTP协议基本就不用在传输这方面下功夫，这个所谓的 “超文本传输协议” 是不是有点名不副实，那么这个HTTP协议的核心部分到底是什么呢 ？

答案就是它的 **传输报文**

HTTP协议规范严格的定义了传输报文的格式，规定了报文的 **组成部分**、**解析规则**、**处理策略**等，正因为有了这些规范，所以可以在TCP/IP层之上实现 **连接控制**、**缓存管理**、**数据编码**、**内容协商** 等 灵活丰富的功能

> #### HTTP协议的报文组成结构

HTTP协议请求/响应报文的组成结构基本相同，具体的由3的部分组成：

1、**起始行（start line）**: 描述请求或响应的基本信息，如：**请求方法**、**请求的URL**、**HTTP版本**、**响应状态码**、**响应状态信息**

2、**头部字段集合（header）**: 使用 key-value 的形式更加详细的描述报文信息

3、**消息正文（entity or body）**: 实际传输的数据，不一定是纯文本，可以是：图片、视频等二进制数据

其中 **起始行** 与 **头部字段** 又合并称为 **请求头** 或 **响应头** ， 消息正文 又称为 **实体** 或 **body**

HTTP 协议规定**传输报文**必须要有 **header**，可以没有 **body** , 并且 header 之后必须要有 **空行** 与 body 隔开

如图：

![](./img/message_01.jpg)

现实的 请求报文 与 响应报文：

![](./img/message_02.png)

> #### 报文起始行（start line）

报文起始行分： 请求行、状态行

**请求行** 就是请求报文的起始行，由3部分构成：

1、**请求方法**：HTTP的动作，如：GET、POST、PUT，表示对资源的操作

2、**请求的目标资源**：通常是一个 URI, 标记了请求动作要操作的资源

3、**HTTP版本号**：表示报文使用的HTTP版本号

这三部分通常使用空格（space）来分隔，最后要用 CRLF 换行表示结束

![](./img/message_03.jpg)

现实的请求行：

```text
POST https://blackhole.m.jd.com/getinfo HTTP/1.1
```

状态行 就是响应报文的起始行，同样也是由3部分构成：

1、**HTTP版本号**：表示报文使用的HTTP版本号

2、**状态码**：3位数字，表示服务器处理的结果

3、**原因**：作为数字状态码的补充描述，处理结果的解释文字，帮忙人类理解

这三部分通常使用空格（space）来分隔，最后要用 CRLF 换行表示结束

![](./img/message_04.jpg)

现实的状态行：

```text
HTTP/1.1 200 OK

HTTP/1.1 404 Not Found
```

> #### 头部字段

头部字段是用 key-value 的形式来表现的，key 和 value 之间用 “**:**”分隔，且 “**key**” 与 “**:**” 之间不能有空格，最后用 CRLF 换行表示字段结束

![](./img/message_05.jpg)
![](./img/message_06.jpg)

HTTP头字段非常灵活，它不仅可以有标准的已有头，如：host、connection 等，也可以支持自定义头，这样决定了HTTP协议的可扩展性，不过没有规矩就不成方圆

**自定义头字段时应注意如下细节：**

1、头字段名不区分大小写，当首字母大小可读性更强，如：Host: www.greenlotuses.com

2、头字段名称不允许有空格，可以使用“-”连接单词，但不能使用下划线“_”，如：可以是 Field-Name:123 , 但不能是 Field Name:123 或 Field_Name:123

3、“**key**”后面必须紧跟着“**:**”，不能有空格，但是“**:**” 后面可以跟着空格， 如：FieldName:   123

4、头字段的顺序不影响语义

5、头字段原则上是不允许重复，除非字段本身语义允许，例如：Set-Cookie 字段就允许重复

> #### 常用的头字段

HTTP协议规定了非常多的头部字段，以实现各种各样的功能，但基本上可以分为4大类：

1、**通用字段**：在请求头、响应头里面都可以出现

2、**请求字段**：仅在请求头里面出现的字段，通常用来说明请求独有的附加信息

3、**响应字段**：仅在响应头里面出现的字段，通常用来说明响应独有的附加信息

4、**实体字段**：实际是通用字段，专门用来说明body的额外信息


![](./img/message_07.png)